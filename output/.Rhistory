install.packages("devtools")
devtools::install_github("jdblischak/workflowr",build_vignettes = TRUE)
A = matrix(rnorm(10*20),nrow = 10)
A
A[-2,,drop = FALSE]
A[,-2,drop = FALSE]
colMeans(A)
A
outer(rep(1,nrow(A)), 1/colMeans(A))
colMeans(A)
require(ashr)
autoselect.mixsd
autoselect.mixsd
ashr
devtools::install_github("stephens999/ashr")
require(ashr)
?autoselect.mixsd
library("ashr")
autoselect.mixsd
ash()
ash
biocLite("pcaMethods")
source("https://bioconductor.org/biocLite.R")
biocLite("pcaMethods")
browseVignettes("pcaMethods")
install.packages('irlba')
set.seed(1)
u <- matrix(rnorm(200), ncol=1)
v <- matrix(c(runif(50, min=0.1), rep(0,250)), ncol=1)
u <- u / drop(sqrt(crossprod(u)))
v <- v / drop(sqrt(crossprod(v)))
x <- u %*% t(v) + 0.001 * matrix(rnorm(200*300), ncol=300)
s <- ssvd(x, n=50)
s <- irlba::ssvd(x, n=50)
s
crossprod()
?crossprod
?crossprod(u)
crossprod(u)
crossprod(v)
drop(sqrt(crossprod(v)))
u <- matrix(rnorm(200), ncol=1)
v <- matrix(c(runif(50, min=0.1), rep(0,250)), ncol=1)
drop(sqrt(crossprod(u)))
set.seed(1)
u <- matrix(rnorm(200), ncol=1)
v <- matrix(c(runif(50, min=0.1), rep(0,250)), ncol=1)
u <- u / drop(sqrt(crossprod(u)))
v <- v / drop(sqrt(crossprod(v)))
x <- u %*% t(v) + 0.01 * matrix(rnorm(200*300), ncol=300)
s <- irlba::ssvd(x, n=50)
s
using(Rmosek)
library(Rmosek)
install.package("Rmosek")
install.packages("Rmosek")
Sys.setenv(PATH=paste(Sys.getenv('PATH'), paste(Sys.getenv('HOME'), 'mosek/8/tools/platform/osx64x86/bin', sep='/'), sep=":"))
install.packages("Rmosek", type="source", repos="http://download.mosek.com/R/8")
require(Rmosek)
lo1 <- list()
lo1$sense <- "max"
lo1$c <- c(3,1,5,1)
lo1$A <- Matrix(c(3,1,2,0,
2,1,3,1,
0,2,0,3), nrow=3, byrow=TRUE, sparse=TRUE)
lo1$bc <- rbind(blc = c(30,15,-Inf),
buc = c(30,Inf,25))
lo1$bx <- rbind(blx = c(0,0,0,0),
bux = c(Inf,10,Inf,Inf))
r <- mosek(lo1)
require(Rmosek)
require(Rmosek)
lo1 <- list()
lo1$sense <- "max"
lo1$c <- c(3,1,5,1)
lo1$A <- Matrix(c(3,1,2,0,
2,1,3,1,
0,2,0,3), nrow=3, byrow=TRUE, sparse=TRUE)
lo1$bc <- rbind(blc = c(30,15,-Inf),
buc = c(30,Inf,25))
lo1$bx <- rbind(blx = c(0,0,0,0),
bux = c(Inf,10,Inf,Inf))
r <- mosek(lo1)
install.packages("varbvs")
varbvs
require(varbvs)
ls
?varbvs
install.packages("glmnet")
library(Rmosek)
set.seed(2017)
test0 = function(n,m){
n = n/3
z = c(rt(n,df=2),2*rt(n,df=4),4*rt(n,df=6))
z = z[order(abs(z))]
data = ashr::set_data(z,1)
grid = ashr:::autoselect.mixsd(data, mult=m, mode=0, mixcompdist = "normal", grange = c(-Inf,Inf))
grid = c(0,grid)
k = length(grid)
g  = ashr::normalmix(rep(1/k,k),rep(0,k),grid)
llik <- t(ashr:::log_comp_dens_conv.normalmix(g,data))
L = llik - apply(llik, 1, max)
L = exp(L)
return(L)
}
test1 = function(A, sparse = TRUE){
rtol = 1e-6
n <- nrow(A)
m <- ncol(A)
A <- t(A)
C <- rep(0,n)
P <- list(sense = "min")
P$c <- C
P$A <- Matrix::Matrix(A, sparse = sparse)
P$bc <- rbind(rep(0,m),rep(1,m))
P$bx <- rbind(rep(0,n),rep(Inf,n))
opro <- matrix ( list (), nrow =5, ncol = n)
rownames ( opro ) <- c(" type ","j","f","g","h")
opro[1,] <-  as.list(rep('log',n))
opro[2,] <-  as.list(1:n)
opro[3,] <-  as.list(-rep(1,n)/n)
opro[4,] <-  as.list(rep(1,n))
opro[5,] <-  as.list(rep(0,n))
P$scopt<- list(opro = opro)
P$dparam$intpnt_nl_tol_rel_gap <- rtol
z <- Rmosek::mosek(P, opts = list(verbose = 0))
if(z$response$code != 0)
stop(paste("Mosek error: ", z$response$msg))
status <- z$sol$itr$solsta
if (status != "OPTIMAL")
warning(paste("Solution status = ", status))
f <- z$sol$itr$suc
if(min(f) < 0) warning("estimated mixing distribution has some negative values:
consider reducing rtol")
g <- as.vector(t(A) %*% (f * rep(1,m)))
list(f = f, g = g, status = status)
}
t1 = system.time(L <- test0(100000,1.15))[3]
t2 = system.time(x <- test1(L))[3]
t1
t2
?flash_r1
library("flashr")
set.seed(10)
l = c(rep(0,500),rnorm(500))
f = rnorm(2000)
LF = outer(l,f)
Y = LF + rnorm(1000*2000)
data = flash_set_data(Y)
f1 = flash_r1(data)
?flash
?flash_r1
library("flashr")
set.seed(10)
l = c(rep(0,50000),rnorm(50000))
f = rnorm(2000)
LF = outer(l,f)
Y = LF + rnorm(100000*2000)
data = flash_set_data(Y)
f1 = flash_r1(data)
install.packages("elasticnet")
library(elasticnet)
install.packages("elasticnet")
library(elasticnet)
set.seed(1)
u <- matrix(rnorm(200), ncol=1)
v <- matrix(c(runif(50, min=0.1), rep(0,250)), ncol=1)
u <- u / drop(sqrt(crossprod(u)))
v <- v / drop(sqrt(crossprod(v)))
x <- v %*% t(v) + 0.01 * matrix(rnorm(200*300), ncol=300)
spca(x)
install.packages("elasticnet")
set.seed(1)
u <- matrix(rnorm(200), ncol=1)
v <- matrix(c(runif(50, min=0.1), rep(0,250)), ncol=1)
u <- u / drop(sqrt(crossprod(u)))
v <- v / drop(sqrt(crossprod(v)))
x <- v %*% t(v) + 0.01 * matrix(rnorm(200*300), ncol=300)
spca(x)
set.seed(1)
u <- matrix(rnorm(200), ncol=1)
v <- matrix(c(runif(50, min=0.1), rep(0,250)), ncol=1)
u <- u / drop(sqrt(crossprod(u)))
v <- v / drop(sqrt(crossprod(v)))
x <- v %*% t(v) + 0.01 * matrix(rnorm(300*300), ncol=300)
spca(x)
spca(x, K = 1)
load("~/git/mixopt-paper/output/results_for_plots.RData")
setwd("~/git/mixopt-paper/output")
pdat <- with(dat1,
rbind(data.frame(formulation = "dual",
method      = "JuMP/MOSEK",
n = n,runtime = t1),
data.frame(formulation = "primal, simplex-constrained",
method      = "JuMP/MOSEK",
n = n,runtime = t2),
data.frame(formulation = "primal, non-negatively-constrained",
method      = "JuMP/MOSEK",
n = n,runtime = t3),
data.frame(formulation = "dual",
method      = "JuMP/SQP",
n = n,runtime = t4),
data.frame(formulation = "primal, simplex-constrained",
method      = "JuMP/SQP",
n = n,runtime = t5),
data.frame(formulation = "primal, non-negatively-constrained",
method      = "JuMP/SQP",
n = n,runtime = t6),
data.frame(formulation = "dual",
method      = "REBayes/KWDual/Rmosek",
n = n,runtime = t7)))
p1 <- ggplot(data = pdat,aes(x = n,y = runtime,color = method,
shape = formulation)) +
geom_line(size = 1) +
geom_point(size = 3) +
scale_x_continuous(trans = "log10",breaks = c(40,100,1e3,1e4)) +
scale_y_continuous(trans = "log10",breaks = c(0.01,0.1,1,10,100)) +
scale_color_manual(values = c(colors[1:2],"darkblue")) +
scale_shape_manual(values = c(8,1,19)) +
labs(x     = "number of rows (n)",
y     = "runtime (seconds)",
title = "Complexity of solving different problem formulations") +
theme_cowplot(font_size = 12) +
theme(#legend.position = c(0,0.75),
plot.title      = element_text(face = "plain",size = 12),
axis.line       = element_blank(),
legend.text     = element_text(size = 10))
library(ggplot2)
library(cowplot)
# ------------------
library(ggplot2)
library(cowplot)
# Colors used in some of the plots below.
colors <- c("#E69F00","#56B4E9","#009E73","#F0E442",
"#0072B2","#D55E00","#CC79A7")
p1 <- ggplot(data = pdat,aes(x = n,y = runtime,color = method,
shape = formulation)) +
geom_line(size = 1) +
geom_point(size = 3) +
scale_x_continuous(trans = "log10",breaks = c(40,100,1e3,1e4)) +
scale_y_continuous(trans = "log10",breaks = c(0.01,0.1,1,10,100)) +
scale_color_manual(values = c(colors[1:2],"darkblue")) +
scale_shape_manual(values = c(8,1,19)) +
labs(x     = "number of rows (n)",
y     = "runtime (seconds)",
title = "Complexity of solving different problem formulations") +
theme_cowplot(font_size = 12) +
theme(#legend.position = c(0,0.75),
plot.title      = element_text(face = "plain",size = 12),
axis.line       = element_blank(),
legend.text     = element_text(size = 10))
p1
levels(dat6_1$label) <-
c("posterior calculations","model fitting (mix-SQP)",
"QR factorization","likelihood computation")
levels(dat6_2$label) <-
c("posterior calculations","model fitting (REBayes/KWDual/Rmosek)",
"likelihood computation")
dat6_1 <- transform(dat6_1,
label = factor(as.character(label),
c("QR factorization",
"model fitting (mix-SQP)",
"posterior calculations",
"likelihood computation")))
pdat <- rbind(transform(dat6_1,
x     = x - 5e3,
label = as.character(label)),
transform(dat6_2,
x     = as.numeric(as.character(x)) + 5e3,
label = as.character(label)))
pdat <- transform(pdat,
label = factor(label,c("QR factorization",
"model fitting (REBayes/KWdual/Rmosek)",
"model fitting (mix-SQP)",
"posterior calculations",
"likelihood computation")))
# Create a plot showing the computation breakdown of adaptive
# shrinkage with the REBayes (MOSEK) and mix-SQP solvers used to
# implement the model fitting.
p5 <- ggplot(pdat,aes(x = x,y = y,fill = label)) +
geom_col(position = "stack",width = 7e3) +
scale_fill_manual(name = "",
values = c("lightskyblue","orange","orangered","aliceblue",
"lightsteelblue")) +
scale_x_continuous(breaks = seq(5e4,25e4,5e4)) +
labs(x = "number of data matrix rows (n)",
y = "computation time (seconds)",
title = "breakdown of adaptive shrinkage computation") +
theme_cowplot(font_size = 12) +
theme(legend.position = c(.05,0.85),
plot.title   = element_text(face = "plain",size = 12),
axis.line    = element_blank(),
axis.ticks.x = element_blank())
p5
levels(dat6_1$label) <-
c("posterior calculations","model fitting (mix-SQP)",
"QR factorization","likelihood computation")
levels(dat6_2$label) <-
c("posterior calculations","model fitting (REBayes)",
"likelihood computation")
dat6_1 <- transform(dat6_1,
label = factor(as.character(label),
c("QR factorization",
"model fitting (mix-SQP)",
"posterior calculations",
"likelihood computation")))
pdat <- rbind(transform(dat6_1,
x     = x - 5e3,
label = as.character(label)),
transform(dat6_2,
x     = as.numeric(as.character(x)) + 5e3,
label = as.character(label)))
pdat <- transform(pdat,
label = factor(label,c("QR factorization",
"model fitting (REBayes)",
"model fitting (mix-SQP)",
"posterior calculations",
"likelihood computation")))
p5 <- ggplot(pdat,aes(x = x,y = y,fill = label)) +
geom_col(position = "stack",width = 7e3) +
scale_fill_manual(name = "",
values = c("lightskyblue","orange","orangered","aliceblue",
"lightsteelblue")) +
scale_x_continuous(breaks = seq(5e4,25e4,5e4)) +
labs(x = "number of data matrix rows (n)",
y = "computation time (seconds)",
title = "breakdown of adaptive shrinkage computation") +
theme_cowplot(font_size = 12) +
theme(legend.position = c(.05,0.85),
plot.title   = element_text(face = "plain",size = 12),
axis.line    = element_blank(),
axis.ticks.x = element_blank())
p5
pdat <- data.frame(n      = rep(2^dat5$n,8),
m      = factor(rep(c(100,200,400,800),each = 20)),
solver = rep(rep(c("REBayes/KWDual/Rmosek","mix-SQP"),each = 10),4),
time   = do.call(c,dat5[-(1:3)]))
p7 <- ggplot(data = pdat,aes(x = n,y = time,color = m,shape = solver)) +
geom_line(size = 1) +
geom_point(size = 3) +
scale_x_continuous(trans = "log10",breaks = c(2e3,1e4,1e5,1e6)) +
scale_y_continuous(trans = "log10",breaks = c(0.01,0.1,1,10,100,1e3)) +
scale_color_manual(values = c("lightskyblue","cornflowerblue",
"mediumblue","darkblue"),
name  = "m (num. cols)") +
labs(x = "n (number of rows in L)",
y = "runtime (seconds)",
title = "Computation time of mix-SQP versue REBayes") +
theme_cowplot(font_size = 12) +
theme(plot.title   = element_text(face = "plain",size = 12),
axis.line    = element_blank())
p7
ggsave("../output/F5.pdf",p7,height = 4,width = 7)
# SAVE PLOTS AS PDFs
# ------------------
ggsave("../output/F1.pdf",p1,height = 4,width = 8)
save.image("~/git/mixopt-paper/output/results_for_plots.RData")
pnorm(rnorm(250,2,1), 2,1)
hist(pnorm(rnorm(250,2,1), 2,1)
)
pnorm(rnorm(250,2,1), 0,1)
pnorm(rnorm(250,2,1), 0,1)
hist
hist(pnorm(rnorm(250,2,1), 0,1)
)
hist(pnorm(rnorm(250,2,1), 0,1), lower.tail = true)
hist(pnorm(rnorm(250,2,1), 0,1), lower.tail = true)
hist(pnorm(rnorm(250,2,1), 0,1,lower.tail = true))
hist(pnorm(rnorm(250,2,1),0,1,lower.tail = true))
?pnorm
hist(pnorm(rnorm(250,2,1),0,1,lower.tail = F))
